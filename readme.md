# Java-game-engine-sandbox
 
Просто песочница и мусорка для тестирования разнообразных концептов и подходов в проектировании так называемых игровых движков. На текущий момент в данном репозитории было опробовано достаточно много вариантов создания одного и того же разными методами и подходами.

Хорошие куски кода были вынесены или, по крайней мере, хотел бы вынести с доработками в отдельные репозитории и библиотеки. На текущий момент вынесены следующие куски:

## Вытащенные во вне модули

### [Математическая библиотека: Kotlin Math Utils](https://github.com/Peytob/Kotlin-math-utils)

Да, на яве тяжело написать хорошую математическую библиотеку для игр, которая могла бы потягаться с GLM в удобстве использования. Однако, вполне можно сделать ограниченную версию с дополнительной функциональностью, которая может быть использована в процедурной генерации.

### ECS [еще живет внутри...]

Сделал вполне добротную и покрутыю тестами ECS систему. Нужно будет вытащить ее в отдельный независимый репозиторий. Однако, будет необходимо перенести на Kotlin и немного пересмотреть методы EcsContext, как по мне можно или декомпозировать на подход с *Accessor.

### Backend [еще живет внутри...]

Получился неплохой набросок бекенда, только стоит почистить его от мусора и сделать нормальный внешний сервис аутентификации.

## В целом, рабочие идеи

### Batch-рендеринг спрайтов в OGL 3.3

Создан весьма неплохой рендер множества двумерных спрайтов на чистом OpenGL 3.3. Изначально происходит создание меша в билдере, где создаются данные для вершинного буфера. После чего происходит рендеринг. Возможна дополнительная оптимизация в виде отказа от постоянного создания и удаления буферов, путем первоначальной настройки множества буферов под фиксированное количество спрайтов.

При рендеренге можно использовать подход и с батчем под разные текстуры, путем использования **sampler2DArray**, но это потребует подготовки текстур заранее.

### Множественные ECS-контексты на стороне сервера

Выполнение множества ECS-контекстов одновременно на стороне сервера - неплохая идея. При таком подходе каждая отдельная локация обрабатывается отдельно и исключается возможность воздействия локаций друг на друга. Однако, появляются некоторые проблемы с переносом данных сущностей игроков с одного контекста в другой.

### Управление ресурсами

В целом, получилась неплохая система управления игровыми ресурсами, мне понравилась. Достаточно простая, поэтому требует ручного управления зависимостями ресурса при его удалении, перемещении и прочих операциях.

### Независимые, непересекающиеся модули и движок-контроллер

Описано одним предложением. Модули минимально пересекаются друг с другом, за исключением зависимых друг от друга модулей. Связь между ними обеспечивает движок. Общие данные и сущности относятся не к модулям, а к самому движку.

## Что учесть в будущем?..

### Не использовать Java для написания игр, по крайней мере на OGL 3 :)

К сожалению, чистая Java весьма неудобная для написания хороших игровых движков из-за своих возможностей работы с памятью. В OpenGL 3 требуется постоянное и весьма хитрое использование буферов памяти, что решается посредствам ByteBuffer из nio. Однако, перезапись таких буфферов крайне неудобная и есть проблемы с перезаписью произвольных частей буфера при использовании **glMapBuffer**.

Отдельным осложнением является неудобная математика. Отсутствует перегрузка операторов, что делает код сильно растянутым, отсутствие возможности автогенерации кода для сложения разных дженериков сильно раздувает код. Так же необходима удобная система констант для того, чтобы не копировать иммутабельные вектора - к сожалению, они имеют проблемы с возможностью случайного изменения. Создания отдельного класса иммутабельного в отдельной ветви наследования опять же сильно усложняет и раздувает код.

### Не переусложнять движок

Не стоит слишком заморачиваться с движком. Он требует более простого и гибкого подхода. Например, взять Pipeline - была хорошей идеей, пока не появились графические ресурсы. Может, стоит аккуратно отдельно их подгрузить, не пытаясь сделать хитрую и универсальную систему для загрузки всего и вся?
